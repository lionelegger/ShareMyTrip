as.controller("MainCtrl",function(o,t,n,e){console.log("call MainCtrl"),t.get("users/current.json").success(function(t){void 0!==t.user&&(o.currentUserId=t.user.id,o.currentUserEmail=t.user.email,o.currentUserFirstname=t.user.first_name,o.currentUserLastname=t.user.last_name)}).error(function(t){o.currentUserId="user undefined"}),o.logout=function(){t.get("Users/logout"),console.log("call logout")},o.newUserToAdd={},o.addNewUser=function(){t.post("Users/add",o.newUserToAdd).success(function(){console.log(o.newUserToAdd),o.newUserToAdd={},e.location.reload()}).error(function(){console.log(o.newUserToAdd),console.log("Something went wrong during user registration")})}}),as.controller("TripsCtrl",function(o,t,n){console.log("call TripsCtrl"),o.loadTrips=function(){console.log("call loadTrips"),n.get("trips.json").success(function(t){o.trips=t.trips,console.log(o.trips),$(".modal-backdrop").hide()}).error(function(){console.log("Something went wrong during load Trips")})},o.loadTrips(),o.loadTrip=function(t){console.log("call loadTrip"),n.get("trips/"+t+".json").success(function(t){o.trip=t.trip,console.log(o.trip)}).error(function(){console.log("Something went wrong during load Trip")})},o.addTrip=function(){console.log("call addTrip"),n.post("Trips/add.json",o.trip).success(function(t){console.log(t.trip),o.trip=t.trip,console.log("Trip "+t.trip.id+" added..."),o.getTripUsers(t.trip.id)}).error(function(){console.log("Something went wrong during add Trip")})},o.editTrip=function(t){console.log("call editTrip with trip "+t),$(".modal .form-message").empty(),t>0?($("#collapseParticipation").collapse("show"),o.loadTrip(t),o.getTripUsers(t)):(o.trip={},o.trips.trip={},$("#collapseParticipation").collapse("hide"))},o.saveTrip=function(t){console.log("call saveTrip with trip "+t),n.post("Trips/edit/"+t,o.trip).success(function(){console.log("trip "+t+" saved!"),o.loadTrips()}).error(function(){console.log("Something went wrong during save Trip")})},o.deleteTrip=function(t){n["delete"]("Trips/delete/"+t).success(function(){console.log("Delete trip "+t),o.loadTrips()}).error(function(){console.log("Something went wrong during save Trip")})},o.getTripUsers=function(t){console.log("call getTripUsers"),n.get("trips/"+t+".json").success(function(t){console.log(t),o.trips.trip=t.trip,console.log("trip users refreshed")}).error(function(){console.log("Something went wrong during load Trip")})},o.tripDeleteUser=function(o){console.log("call tripDeleteUser for user "+o),n["delete"]("TripsUsers/delete/"+o+".json").success(function(){$("#tripDeleteUser").addClass("btn-default").removeClass("btn-danger"),$("#tripDeleteUser-"+o).parent().css("opacity","0.2"),$("#tripDeleteUser-"+o).text("Deleted")}).error(function(){console.log("Something went wrong during delete tripCurrentUser")})},o.userToGet={},o.tripCheckUser=function(){console.log("call tripAddUser"),n.post("Users/getUserFromEmail.json",o.userToGet).success(function(t){console.log("data sent: "+o.userToGet.email),console.log(t.user);var n=$(".modal.fade.in #tripId").first().text();t.user?o.tripAddUser(n,t.user.id):$(".modal.fade.in .form-message").text("User does not exist. Please try another email address."),o.userToGet={}}).error(function(){console.log("Something went wrong during save tripUserToAdd")})},o.tripAddUser=function(t,e){o.tripUserToAdd={trip_id:t,user_id:e},o.currentUserId!=e?(console.log("call tripAddUser for user "+e+" and trip "+t),n.post("TripsUsers/add.json",o.tripUserToAdd).success(function(){$(".modal.fade.in .form-message").text("This user has been added to the current trip"),o.getTripUsers(t),o.tripUserToAdd={}}).error(function(){console.log("Something went wrong during add trip for User "+id)})):$(".modal.fade.in .form-message").text("You already are part of the trip... ")}}),as.controller("ActionCtrl",function(o,t,n){console.log("call ActionCtrl"),o.addAction=function(t){console.log("call addAction"),o.action.type_id=$("ul#type-id li.active").val(),o.action.status=1,o.action.start_date=$("#start_date").val(),o.action.end_date=$("#end_date").val(),o.action.start_name=$("#start-name").val(),o.action.start_lng=$("#start-lng").val(),o.action.start_lat=$("#start-lat").val(),o.action.end_name=$("#end-name").val(),o.action.end_lng=$("#end-lng").val(),o.action.end_lat=$("#end-lat").val(),n.post("Actions/add/"+t,o.action).success(function(){console.log(o.action)}).error(function(){console.log("Something went wrong during add Action")})},o.editAction=function(t,n){console.log("call editAction for action "+n+" and trip "+t),$("#participants input:not(.isParticipating):checked").each(function(){var e=this.checked?$(this).val():"";console.log(e),o.actionAddUser(t,n,e)}),$("#participants input:not(:checked).isParticipating").each(function(){var t=$(this).attr("data-participant");console.log("Delete participation_id = "+t),o.actionDeleteUser(t)}),document.location="actions/plan/"+t},o.deleteAction=function(o,t){n["delete"]("Actions/delete/"+t).success(function(){console.log("Delete Action "+t),document.location="actions/plan/"+o}).error(function(){console.log("Something went wrong during delete Action")})},o.actionDeleteUser=function(o){console.log("call deleteActionUser for: user "+o),n["delete"]("actions-users/delete/"+o).success(function(){console.log("A Participant has been removed!")}).error(function(){console.log("Something went wrong during add action for User "+id)})},o.actionAddUser=function(t,e,s){console.log("call actionAddUser for: user "+s+", action "+e+", trip "+t),o.actionUserToAdd={action_id:e,user_id:s},n.post("actions-users/add.json",o.actionUserToAdd).success(function(){o.actionUserToAdd={}}).error(function(){console.log("Something went wrong during add action for User "+id)})},o.actionDeleteAllUsers=function(t){console.log("call actionDeleteAllUsers for action "+t),n.get("actions/view/"+t+".json").success(function(e){o.actions.action.users.forEach(function(e){e.id!=o.currentUserId?($deleteId=$("#user-"+e.id).attr("deleteId"),n["delete"]("actions-users/delete/"+$deleteId+".json").success(function(){o.actionListParticipants(o.actions.action.trip.id,t),$("#user-"+$userId).removeClass("btn-success"),console.log("Participant has been removed!")}).error(function(){console.log("Something went wrong during add action for User "+id)})):$("#user-"+$userId+" span.glyphicon.glyphicon-ok").remove()})}).error(function(){console.log("Something went wrong during add all users for the current action")})},o.actionAddAllUsers=function(t){console.log("call actionAddAllUsers for action "+t),n.get("actions/view/"+t+".json").success(function(e){o.actions.action.trip.users.forEach(function(e){e.id!=o.currentUserId&&(o.actionUserToAdd={action_id:t,user_id:e.id},n.post("actions-users/add.json",o.actionUserToAdd).success(function(){o.actionUserToAdd={},o.actionListParticipants(o.actions.action.trip.id,t)}).error(function(){console.log("Something went wrong during add action for User "+id)}))})}).error(function(){console.log("Something went wrong during add all users for the current action")})},o.actionListParticipants=function(t,e){console.log("call actionListParticipants for action "+e+" and trip "+t),n.get("trips/"+t+".json").success(function(t){console.log(t),o.trips=t,n.get("actions/view/"+e+".json").success(function(t){console.log(t),o.actions=t,o.actions.action.users.forEach(function(o){$userId=o._joinData.user_id,$deleteId=o._joinData.id,console.log("Participant id = "+$userId),$("#user-"+$userId).addClass("btn-success").attr("deleteId",$deleteId)})}).error(function(){console.log("Something went wrong during load Action")})}).error(function(){console.log("Something went wrong during load Trip")})},o.actionListPayments=function(t){console.log("call actionListPayments for action "+t),n.get("actions/view/"+t+".json").success(function(n){console.log(n),o.action=n.action,o.action.payments.totalAll=0,o.action.payments.totalAuth=0,o.action.payments.forEach(function(t){t.user_id==o.currentUserId&&(o.action.payments.totalAuth+=t.amount),o.action.payments.totalAll+=t.amount}),o.updateStatus(t)}).error(function(){console.log("Something went wrong during load Payments")})},o.updateStatus=function(t){o.action.status=0,console.log("TOTAL = "+o.action.payments.totalAll),console.log("PRICE = "+o.action.price),0===o.action.payments.totalAll?o.action.status=2:o.action.payments.totalAll==o.action.price?o.action.status=4:o.action.payments.totalAll>o.action.price?o.action.status=5:o.action.status=3,null===o.action.price&&(o.action.status=1),o.actionStatusUpdate={status:o.action.status},n.post("actions/edit/"+t+".json",o.actionStatusUpdate).success(function(){console.log("Status updated successfully"),o.actionStatusUpdate={}}).error(function(){console.log("Something went wrong during update status")})},o.actionDeletePayment=function(t,e){console.log("call actionDeletePayment for payment "+t),n["delete"]("Payments/delete/"+t+".json").success(function(){console.log("Payment deleted"),o.actionListPayments(e)}).error(function(){console.log("Something went wrong during delete payment")})},o.actionPaymentToAdd={},o.actionAddPayment=function(t,e){o.actionPaymentToAdd.action_id=t,o.actionPaymentToAdd.user_id=e,console.log("call actionAddPayment for action "+t+" and user "+e),n.post("Payments/add.json",o.actionPaymentToAdd).success(function(){console.log(o.actionPaymentToAdd),o.actionPaymentToAdd={}}).error(function(){console.log("Something went wrong during add payment to action "+t)})}});