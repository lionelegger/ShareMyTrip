as.controller("MainCtrl",function(o,e,t,n){console.log("call MainCtrl"),e.get("users/current.json").success(function(e){void 0!=e.user&&(o.currentUserId=e.user.id,o.currentUserEmail=e.user.email,o.currentUserFirstname=e.user.first_name,o.currentUserLastname=e.user.last_name)}).error(function(e){o.currentUserId="user undefined"}),o.logout=function(){e.get("Users/logout"),console.log("call logout")},o.newUserToAdd={},o.addNewUser=function(){e.post("Users/add",o.newUserToAdd).success(function(){console.log(o.newUserToAdd),o.newUserToAdd={},n.location.reload()}).error(function(){console.log(o.newUserToAdd),console.log("Something went wrong during user registration")})}}),as.controller("TripsCtrl",function(o,e,t){console.log("call TripsCtrl"),o.loadTrips=function(){console.log("call loadTrips"),t.get("trips.json").success(function(e){o.trips=e.trips,console.log(o.trips),$(".modal-backdrop").hide()}).error(function(){console.log("Something went wrong during load Trips")})},o.loadTrips(),o.loadTrip=function(e){console.log("call loadTrip"),t.get("trips/"+e+".json").success(function(e){o.trip=e.trip,console.log(o.trip)}).error(function(){console.log("Something went wrong during load Trip")})},o.addTrip=function(){console.log("call addTrip"),t.post("Trips/add.json",o.trip).success(function(e){o.trip=e.trip,console.log("Trip "+e.trip.id+" added..."),o.getTripUsers(e.trip.id)}).error(function(){console.log("Something went wrong during add Trip")})},o.editTrip=function(e){console.log("call editTrip with trip "+e),$(".modal .form-message").empty(),e>0?($("#collapseParticipation").collapse("show"),o.loadTrip(e),o.getTripUsers(e)):(o.trip={},o.trips.trip={},$("#collapseParticipation").collapse("hide"))},o.saveTrip=function(e){console.log("call saveTrip with trip "+e),t.post("Trips/edit/"+e,o.trip).success(function(){console.log("trip "+e+" saved!"),o.loadTrips()}).error(function(){console.log("Something went wrong during save Trip")})},o.deleteTrip=function(e){t["delete"]("Trips/delete/"+e+".json").success(function(){console.log("Delete trip "+e),o.loadTrips()}).error(function(){console.log("Something went wrong during save Trip")})},o.getTripUsers=function(e){console.log("call getTripUsers"),t.get("trips/"+e+".json").success(function(e){console.log(e),o.trips.trip=e.trip,console.log("trip users refreshed")}).error(function(){console.log("Something went wrong during load Trip")})},o.tripDeleteUser=function(o){console.log("call tripDeleteUser for user "+o),t["delete"]("TripsUsers/delete/"+o+".json").success(function(){$("#tripDeleteUser").addClass("btn-default").removeClass("btn-danger"),$("#tripDeleteUser-"+o).parent().css("opacity","0.2"),$("#tripDeleteUser-"+o).text("Deleted")}).error(function(){console.log("Something went wrong during delete tripCurrentUser")})},o.userToGet={},o.tripCheckUser=function(){console.log("call tripAddUser"),t.post("Users/getUserFromEmail.json",o.userToGet).success(function(e){console.log("data sent: "+o.userToGet.email),console.log(e.user);var t=$(".modal.fade.in #tripId").first().text();e.user?o.tripAddUser(t,e.user.id):$(".modal.fade.in .form-message").text("User does not exist. Please try another email address."),o.userToGet={}}).error(function(){console.log("Something went wrong during save tripUserToAdd")})},o.tripAddUser=function(e,n){o.tripUserToAdd={trip_id:e,user_id:n},o.currentUserId!=n?(console.log("call tripAddUser for user "+n+" and trip "+e),t.post("TripsUsers/add.json",o.tripUserToAdd).success(function(){$(".modal.fade.in .form-message").text("This user has been added to the current trip"),o.getTripUsers(e),o.tripUserToAdd={}}).error(function(){console.log("Something went wrong during add trip for User "+id)})):$(".modal.fade.in .form-message").text("You already are part of the trip... ")}}),as.controller("ActionCtrl",function(o,e,t){console.log("call ActionCtrl"),o.actionAddUser=function(e,n,s){console.log("call actionAddUser for: user "+s+", action "+n+", trip "+e),o.actionUserToAdd={action_id:n,user_id:s},$("#user-"+s).hasClass("btn-success")?($deleteId=$("#user-"+s).attr("deleteId"),t["delete"]("actions-users/delete/"+$deleteId+".json").success(function(){o.actionListParticipants(e,n),$("#user-"+s).removeClass("btn-success"),console.log("Participant has been removed!")}).error(function(){console.log("Something went wrong during add action for User "+id)})):t.post("actions-users/add.json",o.actionUserToAdd).success(function(){o.actionUserToAdd={},o.actionListParticipants(e,n)}).error(function(){console.log("Something went wrong during add action for User "+id)})},o.actionDeleteAllUsers=function(e){console.log("call actionDeleteAllUsers for action "+e),t.get("actions/view/"+e+".json").success(function(n){o.actions.action.users.forEach(function(n){n.id!=o.currentUserId?($deleteId=$("#user-"+n.id).attr("deleteId"),t["delete"]("actions-users/delete/"+$deleteId+".json").success(function(){o.actionListParticipants(o.actions.action.trip.id,e),$("#user-"+$userId).removeClass("btn-success"),console.log("Participant has been removed!")}).error(function(){console.log("Something went wrong during add action for User "+id)})):$("#user-"+$userId+" span.glyphicon.glyphicon-ok").remove()})}).error(function(){console.log("Something went wrong during add all users for the current action")})},o.actionAddAllUsers=function(e){console.log("call actionAddAllUsers for action "+e),t.get("actions/view/"+e+".json").success(function(n){o.actions.action.trip.users.forEach(function(n){n.id!=o.currentUserId&&(o.actionUserToAdd={action_id:e,user_id:n.id},t.post("actions-users/add.json",o.actionUserToAdd).success(function(){o.actionUserToAdd={},o.actionListParticipants(o.actions.action.trip.id,e)}).error(function(){console.log("Something went wrong during add action for User "+id)}))})}).error(function(){console.log("Something went wrong during add all users for the current action")})},o.actionListParticipants=function(e,n){console.log("call actionListParticipants for action "+n+" and trip "+e),t.get("trips/"+e+".json").success(function(e){console.log(e),o.trips=e,t.get("actions/view/"+n+".json").success(function(e){console.log(e),o.actions=e,o.actions.action.users.forEach(function(o){$userId=o._joinData.user_id,$deleteId=o._joinData.id,console.log("Participant id = "+$userId),$("#user-"+$userId).addClass("btn-success").attr("deleteId",$deleteId)})}).error(function(){console.log("Something went wrong during load Action")})}).error(function(){console.log("Something went wrong during load Trip")})},o.actionListPayments=function(e){console.log("call actionListPayments for action "+e),t.get("actions/view/"+e+".json").success(function(n){console.log(n),o.action=n.action,o.action.payments.totalAll=0,o.action.payments.totalAuth=0,o.action.payments.forEach(function(e){e.user_id==o.currentUserId&&(o.action.payments.totalAuth+=e.amount),o.action.payments.totalAll+=e.amount}),o.action.status=0,console.log("TOTAL = "+o.action.payments.totalAll),console.log("PRICE = "+o.price),0==o.action.payments.totalAll?o.action.status=1:o.action.payments.totalAll==o.action.price?o.action.status=3:""==o.action.price?o.action.status=0:o.action.payments.totalAll>o.action.price?o.action.status=4:o.action.status=2,o.actionStatusUpdate={status:o.action.status},t.post("actions/edit/"+e+".json",o.actionStatusUpdate).success(function(){console.log("Status updated successfully"),o.actionStatusUpdate={}}).error(function(){console.log("Something went wrong during update status")})}).error(function(){console.log("Something went wrong during load Payments")})},o.actionDeletePayment=function(e,n){console.log("call actionDeletePayment for payment "+e),t["delete"]("Payments/delete/"+e+".json").success(function(){console.log("Payment deleted"),o.actionListPayments(n)}).error(function(){console.log("Something went wrong during delete payment")})},o.actionPaymentToAdd={},o.actionAddPayment=function(e,n){o.actionPaymentToAdd.action_id=e,o.actionPaymentToAdd.user_id=n,console.log("call actionAddPayment for action "+e+" and user "+n),t.post("Payments/add.json",o.actionPaymentToAdd).success(function(){console.log(o.actionPaymentToAdd),o.actionPaymentToAdd={}}).error(function(){console.log("Something went wrong during add payment to action "+e)})}});